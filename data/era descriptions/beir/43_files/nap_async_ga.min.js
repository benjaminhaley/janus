function trackClick(){}function dummyUrchin(){this._initData=function(){},this._trackPageview=function(){}}function isCheckoutPage(){return document.location.href.match(/checkout\.cgi/)?document.title.match(/4 Order Receipt/)?4:document.title.match(/3 Review/)?3:document.title.match(/2 Ship and Pay/)?2:document.title.match(/1 Delivery Information/)?1:!1:!1}function trackPageview(){for(var a in trackers){var b=trackers[a].alias,c=trackers[a].id,d=trackers[a].domain,e=getParentTopicName(getPageTopicID())||"(none)",f=getLoginStatus(),g="//www.google-analytics.com/plugins/ga/inpage_linkid.js";isCheckoutPage()?_gaq.push([b+"._require","inpage_linkid",g],[b+"._setAccount",c],[b+"._setDomainName",d],[b+"._setCustomVar",1,"login",f,2],[b+"._setCustomVar",2,"topic",e,3],[b+"._trackPageview","/cart/checkout.cgi?step="+isCheckoutPage()]):d!==void 0&&null!==d?_gaq.push([b+"._require","inpage_linkid",g],[b+"._setAccount",c],[b+"._setDomainName",d],[b+"._setCustomVar",1,"login",f,2],[b+"._setCustomVar",2,"topic",e,3],[b+"._trackPageview"]):_gaq.push([b+"._require","inpage_linkid",g],[b+"._setAccount",c],[b+"._setCustomVar",1,"login",f,2],[b+"._setCustomVar",2,"topic",e,3],[b+"._trackPageview"])}}function trackEvent(a,b,c,d){d=Math.round(d||0);for(var e in trackers)"on"==trackers[e].events&&_gaq.push([trackers[e].alias+"._trackEvent",a,b,c,d])}function getLoginStatus(){return document.cookie.indexOf("ATYPE=")>0&&document.cookie.indexOf("NAP=")>0?"member":document.cookie.indexOf("ATYPE=")>0?"guest":"none"}function getIdFromUrl(a){var b=a.match(/record_id\=([0-9]{1,5})/);return b?b[1]:!1}function getPageTopicID(){if(getIdFromUrl(document.location.href)){var a=getIdFromUrl(document.location.href),b=data_layer[a].topics;if(b.length>0){if("string"==typeof b[0].parent_id)return b[0].parent_id;if("string"==typeof b[0].id)return b[0].id}}return!1}function getParentTopicName(a){var b={276:"Agriculture",277:"Behavioral and Social Sciences",278:"Biology and Life Sciences",279:"Computers and Information Technology",280:"Conflict and Security Issues",281:"Earth Sciences",282:"Education",283:"Energy and Energy Conservation",284:"Engineering and Technology",285:"Environment and Environmental Studies",286:"Explore Science",287:"Food and Nutrition",288:"Health and Medicine",289:"Industry and Labor",290:"Math, Chemistry and Physics",292:"Biography and Autobiography",293:"Space and Aeronautics",294:"Transportation",423:"Policy for Science and Technology"};try{return b[a]}catch(c){return!1}}function getSelectedText(){var a="";return a=window.getSelection?""+window.getSelection():document.getSelection?""+document.getSelection():document.selection.createRange().text}var trackers=[{alias:"nax",id:"UA-2130316-2",domain:".nap.edu",events:"on",ecommerce:"off"},{alias:"digops",id:"UA-2382644-1",domain:".nap.edu",events:"on",ecommerce:"on"},{alias:"big",id:"UA-3065995-1",domain:".nap.edu",events:"off",ecommerce:"off"}];firstTracker=new dummyUrchin,secondTracker=new dummyUrchin,thirdTracker=new dummyUrchin,function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}();var _gaq=_gaq||[],data_layer=[];$(document).ready(function(a){function b(b){id_list="";for(var c in b)id_list+=b[c]+"|";id_list=id_list.substr(0,id_list.length-1),a.getJSON("/includes/data_layer.php?record_id="+id_list,function(b){a.each(b,function(a,b){var c={record_id:b.record_id,title:b.title,price:b.price?b.price[0]:0,isbn:b.isbn?b.isbn[0]:"",topics:b.topics?b.topics:""};data_layer[b.record_id]=c}),trackPageview()})}a("img[src*='404error.gif']").length>0&&trackEvent("error","404",document.location.href);var c=[];a('a[href*="download.cgi"], a[href*="cart.cgi"]').each(function(){if(a(this).attr("href").match(/record_id\=([0-9]+)/)){var b=a(this).attr("href").match(/record_id\=([0-9]+)/)[1];c.push(b)}}),getIdFromUrl(document.location.href)&&c.push(getIdFromUrl(document.location.href)),b(c),a("a").on("click",function(){var b="nap.edu",c=this.href,d=getIdFromUrl(c)?data_layer[getIdFromUrl(c)]:data_layer[getIdFromUrl(document.location.href)];if(c.match(/\.(zip|mp\d+|mpe*g|pdf|docx*|pptx*|xlsx*|jpe*g|png|gif|tiff*)/i)&&trackEvent("file",c.match(/\.(zip|mp\d+|mpe*g|pdf|docx*|pptx*|xlsx*|jpe*g|png|gif|tiff*)/i)[0],c.replace(/^.*\/\//,"")),localUrl=RegExp("http.?://([^/]+?)?.?"+b,"gi"),c.match(/^http/)&&!c.match(localUrl)&&trackEvent("outbound",c.match(/\/\/([^\/]+)/)[1],c.replace(/^.*\/\//,"")),c.match(/^mailto/)&&trackEvent("email","send",c.replace(/^mailto:/i,"")),c.match(/^http.?:\/\/feeds\.nap\.edu\/nap\/([^\/]+)/i)){var e=c.match(/\/nap\/([^\/]+)/i)[1],f=c;e.match(/notes/i)?f="Notes from NAP":e.match(/new/i)&&(f=c.match(/(\d{3})/)?getParentTopicName(c.match(/(\d{3})/)[0]):"All Titles"),trackEvent("feed",e,f)}c.match(/download\.cgi.+?file=/)?trackEvent("download","chapter",d.record_id+": "+this.text,0):c.match(/report\.cgi.+?type=pdfxsum/)?trackEvent("download","summary",d.record_id+": summary",0):c.match(/download\.cgi/)&&trackEvent("download","book",d.record_id+": full book",0),c.match(/cart\.cgi.+?action=buy/)&&trackEvent("cart","add",c.match(/isbn=([0-9\-x]+)/i)[1],0),c.match(/cart\.cgi.+?action=remove/)&&trackEvent("cart","remove",c.match(/remove=([0-9\-x]+)/i)[1],0),c.match(/cart\.cgi/)&&!c.match(/action=buy/)&&(document.location.href.match(/checkout\.cgi/)?trackEvent("cart","return","return to cart"):trackEvent("cart","view",this.text)),!c.match(/login\.php/)||c.match(/action=logout/)||c.match(/action=new/)||trackEvent("mynap","window","show"),c.match(/napguest\.php/)&&trackEvent("mynap","guest","continue as guest"),c.match(/login\.php/)&&c.match(/action=new/)&&trackEvent("mynap","new","continue to create account"),c.match(/login\.php\?action=logout/)&&trackEvent("mynap","logout","logout"),c.match(/mynap\.php/)&&trackEvent("mynap","main","go to MyNAP"),c.match(/previewwidget\.php/)&&trackEvent("widget","preview",c.match(/wid\=([0-9]+)/)[1]),c.match(/javascript:.+?rights/)&&trackEvent("rights","rightslink click",d.title)}),a(".TabbedPanelsTab").on("click",function(){trackEvent("catalog","tab",a(this).text())}),a("#tabvanilla .tabnav a").on("click",function(){trackEvent("catalog","tab",a(this).text())}),a("body").on("click",".summary .read-more a",function(){trackEvent("catalog","description","read more")}),a("body").on("click",".details .read-less a",function(){trackEvent("catalog","description","read less")}),a(".ui-tabs-panel a").on("click",function(){var c=a(this).closest(".ui-tabs-panel").attr("id");trackEvent("catalog","top "+c+" links",a(this).closest("li").attr("class").replace("n","")+" - "+a(this).text())}),a("#relbooks-container a").on("click",function(){var c=parseInt(a(this).closest("ul").find("li").index(a(this).closest("li")),10)/2+1,d=a(this).parent().is(".relbooks_cover")?"cover":"title",e=a(this).closest("li").find("strong a").text();trackEvent("catalog","related links",c+" - "+d+" - "+e)}),a(".coverblock_on a").on("click",function(){trackEvent("catalog","cover","show larger cover")}),a("body").on("click",".GB_header .close img",function(){trackEvent("catalog","cover","close larger cover")}),a('form[action*="login.php"]').on("submit",function(){"create"==a(this).children('input:hidden[name="action"]').val()?trackEvent("mynap","new","submit signup"):trackEvent("mynap","login","submit login")}),a("#homecenter .contentdiv a.headline").on("click",function(){var c=parseInt(a("#homecenter .contentdiv").index(a(this).closest(".contentdiv")),10)+1;trackEvent("homepage slider",c+" - title",a(this).text())}),a("#homecenter .contentdiv .sliderimg").on("click",function(){var c=parseInt(a("#homecenter .contentdiv").index(a(this).closest(".contentdiv")),10)+1,d=a(this).closest(".contentdiv").find(".headline").text();trackEvent("homepage slider",c+" - cover",d)}),a("#homecenter .contentdiv p a").on("click",function(){var c=parseInt(a("#homecenter .contentdiv").index(a(this).closest(".contentdiv")),10)+1,d=a(this).closest(".contentdiv").find(".headline").text();trackEvent("homepage slider",c+" - text link",d)}),a("#homecenter table#new p a").on("click",function(){var c=parseInt(a("#homecenter table#new tr:first td").index(a(this).closest("td")),10)+1,d=a(this).closest("td").find("p a").text();trackEvent("homepage news",c+" - title",d)}),a("#homecenter table#new .cover a").on("click",function(){var c=parseInt(a("#homecenter table#new tr:first td").index(a(this).closest("td")),10)+1,d=a(this).closest("td").find("p a").text();trackEvent("homepage news",c+" - cover",d)}),a("#homecenter table#new td.details a").on("click",function(){var c=parseInt(a("#homecenter table#new td.details").index(a(this).closest("td")),10)+1,d=a(this).closest("table").find("tr:first td").eq(c-1).find("p a").text();trackEvent("homepage news",c+" - details",d)}),a('form[action*="napguest.php"]').on("submit",function(){trackEvent("mynap","guest","submit guest")}),a("td.close img").on("click",function(){trackEvent("mynap","window","close")}),a('form[action*="cart.cgi"]').on("submit",function(){document.location.href.match(/cart\.cgi/)||trackEvent("cart","add",a('input:hidden[name="isbn"]').val(),0)}),a('input:image[name="checkout"]').on("click",function(){trackEvent("cart","checkout","proceed to checkout")}),a('form[action*="comment.php"]').on("submit",function(){trackEvent("download","comment",a(".pdf_winopen_comments").val())}),a("#widget").on("click",function(){trackEvent("widget","embed code select",a('#widgetdisplay a[href*="previewwidget.php"]').attr("href").match(/wid\=([0-9]+)/)[1])}),a("#widget").on("copy",function(){trackEvent("widget","embed code copy",a('#widgetdisplay a[href*="previewwidget.php"]').attr("href").match(/wid\=([0-9]+)/)[1])}),a(".cm a").on("click",function(){trackEvent("citation","window","open")}),a('#citemgr a[href*="ReverseContentDisplay"]').on("click",function(){trackEvent("citation","window","close")}),a('#citemgr a[href*="citation.cgi"]').on("click",function(){trackEvent("citation","format download",this.href.match(/type\=(.+?)\&/)[1])}),a('form[action*="openbook.php"], form[action*="booksearch.php"]').on("submit",function(){trackEvent("openbook","search",a(this).find('input[name="term"]').not("#header_search").val())}),a('form[action*="napsearch.php"]').on("submit",function(){trackEvent("site search","submit query",a(this).find(".term").val())}),a("#obpagenavcenter li a").on("click",function(){trackEvent("openbook","nav",a(this).closest("li").attr("class"))}),a("li.obprint a").on("click",function(){trackEvent("openbook","print",this.href.replace(/^.*\/\//,""))}),a("a#arrow").on("click",function(){action=a(this).hasClass("open")?"open":"close",trackEvent("openbook","toc",action)}),a(".obright li:lt(3) a").on("click",function(){sizes=["small","medium","large"],position=parseInt(a(".obright li:lt(3) a").index(a(this)),10),trackEvent("openbook","font size",sizes[position])}),a(".chapname a, #rightcolumn a, #chaphits td:nth-child(2) a").on("click",function(){this.href.match(/openbook\.php/)&&trackEvent("openbook","chapter",this.text)}),a("#chaphits td:first-child a").on("click",function(){trackEvent("openbook","context search",a(this).parent().next().children("a").text())}),a("#contexthits a").on("click",function(){trackEvent("openbook","context result",this.text)}),a("li.save a").on("click",function(){var b=this.href,c=getIdFromUrl(b)?data_layer[getIdFromUrl(b)]:data_layer[getIdFromUrl(document.location.href)];trackEvent("mynap","save book",c.record_id)}),a("a.removelink").on("click",function(){record_id=a(this).attr("onclick").match(/\d+/)[0],trackEvent("mynap","remove book",record_id)}),a("li.bookmark a").on("click",function(){var b=this.href,c=getIdFromUrl(b)?data_layer[getIdFromUrl(b)]:data_layer[getIdFromUrl(document.location.href)];trackEvent("mynap","add bookmark",c.record_id)}),a("a.removelinknospace").on("click",function(){record_id=a(this).attr("onclick").match(/\d+/)[0],trackEvent("mynap","remove bookmark",record_id)}),a("a.favenote, a.editnote").on("click",function(){var c=a(this).attr("href").match(/r=(\d+)/)[1];trackEvent("mynap","view/edit bookmark note",c)});var d="";a("#citemgr p:first").on("mousedown",function(){d=getSelectedText()}),a("#citemgr p:first").on("mouseup",function(a){var b=getSelectedText(),c=250>b.length?b:b.substr(0,220)+" ... "+b.substr(-25),e=a.which;b.length>0&&3==e?trackEvent("citation","right-click",c):b!=d&&b.length>0&&1==e&&trackEvent("citation","highlight text",c)}),a("#openbook_htmlview").children().not(".disclaimer").on("mousedown",function(){d=getSelectedText()}),a("#openbook_htmlview").children().not(".disclaimer").on("mouseup",function(a){var b=getSelectedText(),c=250>b.length?b:b.substr(0,220)+" ... "+b.substr(-25),e=a.which;b.length>0&&3==e?trackEvent("openbook","right-click",c):b!=d&&b.length>0&&1==e&&trackEvent("openbook","highlight text",c)})});